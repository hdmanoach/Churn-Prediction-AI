<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Prédiction Churn</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#051445'
                    }
                }
            }
        }
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gradient-to-br from-green-50 to-gray-100 min-h-screen flex flex-col items-center py-10">

    <!-- Boutons Accueil et About FIXES -->
    <div class="fixed top-6 right-6 z-50 flex gap-4">
        <a href="/" class="bg-gray-900 text-white px-5 py-2 rounded-full shadow-lg hover:bg-black transition duration-300">
            Accueil
        </a>
        <a href="/about" class="bg-gray-900 text-white px-5 py-2 rounded-full shadow-lg hover:bg-black transition">
            About
        </a>
    </div>

    <div class="w-full max-w-2xl space-y-10">

        <!-- CARD FORMULAIRE -->
        <div class="bg-white/90 backdrop-blur-lg p-10 rounded-3xl shadow-2xl">
            <h2 class="text-3xl font-extrabold text-primary text-center mb-8">
                Prédiction de Churn Client
            </h2>

            <form action="/predict" method="post" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-6">

                    <div>
                        <label class="block mb-2 font-semibold text-gray-700">Gender</label>
                        <select name="gender"
                                class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-primary focus:outline-none">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>

                    <div>
                        <label class="block mb-2 font-semibold text-gray-700">Senior Citizen</label>
                        <select name="SeniorCitizen"
                                class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-primary focus:outline-none">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>

                    <div>
                        <label class="block mb-2 font-semibold text-gray-700">Tenure (mois)</label>
                        <input type="number" name="tenure" required
                               class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-primary focus:outline-none">
                    </div>

                    <div>
                        <label class="block mb-2 font-semibold text-gray-700">Monthly Charges</label>
                        <input type="number" step="0.01" name="MonthlyCharges" required
                               class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-primary focus:outline-none">
                    </div>

                </div>

                <button type="submit"
                        class="w-full bg-primary text-white py-4 rounded-2xl text-lg font-bold hover:bg-green-700 transition duration-300 shadow-md">
                    Lancer la prédiction
                </button>
            </form>
        </div>

        {% if result %}
        <!-- CARD RESULTAT + GRAPHIQUE -->
        <div class="bg-white/90 backdrop-blur-lg p-10 rounded-3xl shadow-2xl space-y-8">
            
            <!-- RESULTAT TEXTE -->
            <div class="text-center">
                <h3 class="text-2xl font-bold text-gray-800">{{ result }}</h3>
                <p class="mt-3 text-lg text-gray-600">
                    Probabilité de churn :
                    <span class="font-extrabold text-primary text-xl">{{ proba }}%</span>
                </p>
            </div>

            <!-- GRAPHIQUE -->
            <div class="flex justify-center">
                <div class="w-72 h-72">
                    <canvas id="churnChart"></canvas>
                </div>
            </div>

            <script>
                const ctx = document.getElementById('churnChart');

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Reste', 'Churn'],
                        datasets: [{
                            data: [{{ 100 - proba }}, {{ proba }}],
                            backgroundColor: ['#22c55e', '#ef4444'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        cutout: '65%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { font: { size: 14 } }
                            }
                        }
                    }
                });
            </script>

        </div>
        {% endif %}

    </div>

</body>
</html>
